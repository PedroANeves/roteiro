name: Build Releases

on:
  push:
    tags: ['v*']
    branches: ['cicd']
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10.x'

      - name: install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
  
      - name: build execultable
        run: |
          pip install pyinstaller
          pyinstaller --strip --onefile src/roteiro.py

      - name: upload execultable
        uses: actions/upload-artifact@v4
        with:
          name: roteiro_linux
          path: dist/roteiro

  # build-win:
  #   runs-on: windows-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-python@v5
  #       with:
  #         python-version: '3.10.x'

  #     - name: install dependencies
  #       run: |
  #         python -m pip install --upgrade pip
  #         pip install -r requirements.txt
  
  #     - name: build execultable
  #       run: |
  #         pip install pyinstaller
  #         pyinstaller --onefile src/roteiro.py

  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: roteiro_win
  #         path: dist/roteiro.exe

  release:
    # needs: [build, build-win]
    needs: [build]
    runs-on: ubuntu-latest
    permissions:
        contents: write
    steps:
      - uses: actions/checkout@v4

      - name: download linux build
        uses: actions/download-artifact@v4
        with:
          name: roteiro_linux
          path: build/linux
    
      - run: find ~+ -type f -name '*roteiro*'
      - run: ls -la /home/runner/work/roteiro/roteiro
      - run: tree -I '.git'

    #   - name: download windows build
    #     uses: actions/download-artifact@v4
    #     with:
    #       name: roteiro_win
  
    #   - uses: ncipollo/release-action@v1
    #     with:
    #       artifacts: "**roteiro_linux.zip,**roteiro_win.zip"
    #       bodyFile: "CHANGELOG.md"
    #       draft: true
